"use strict";(self.webpackChunkapollo_testing_toolkit_link_docs=self.webpackChunkapollo_testing_toolkit_link_docs||[]).push([[611],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return y}});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,p=a(e,["components","mdxType","originalType","parentName"]),d=c(n),y=o,g=d["".concat(l,".").concat(y)]||d[y]||u[y]||i;return n?r.createElement(g,s(s({ref:t},p),{},{components:n})):r.createElement(g,s({ref:t},p))}));function y(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,s=new Array(i);s[0]=d;var a={};for(var l in t)hasOwnProperty.call(t,l)&&(a[l]=t[l]);a.originalType=e,a.mdxType="string"==typeof e?e:o,s[1]=a;for(var c=2;c<i;c++)s[c]=n[c];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},1889:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return a},contentTitle:function(){return l},metadata:function(){return c},toc:function(){return p},default:function(){return d}});var r=n(3117),o=n(102),i=(n(7294),n(3905)),s=["components"],a={id:"usage-in-cypress",title:"Usage in Cypress",sidebar_label:"Usage in Cypress",custom_edit_url:null,hide_title:!0},l="Usage in Cypress",c={unversionedId:"usage-in-cypress",id:"usage-in-cypress",isDocsHomePage:!1,title:"Usage in Cypress",description:"Due to Cypress execution order, you need to wrap any calls to the interceptors with cy.then().",source:"@site/docs/usage-in-cypress.md",sourceDirName:".",slug:"/usage-in-cypress",permalink:"/docs/usage-in-cypress",editUrl:null,tags:[],version:"current",frontMatter:{id:"usage-in-cypress",title:"Usage in Cypress",sidebar_label:"Usage in Cypress",custom_edit_url:null,hide_title:!0},sidebar:"default",previous:{title:"ApolloTestingToolkit",permalink:"/docs/api/modules/ApolloTestingToolkit"},next:{title:"Logging and recording",permalink:"/docs/logging-and-recording"}},p=[{value:"Pitfall: Data that comes outside of Apollo",id:"pitfall-data-that-comes-outside-of-apollo",children:[],level:2}],u={toc:p};function d(e){var t=e.components,n=(0,o.Z)(e,s);return(0,i.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"usage-in-cypress"},"Usage in Cypress"),(0,i.kt)("p",null,"Due to Cypress execution order, you need to wrap any calls to the interceptors with ",(0,i.kt)("inlineCode",{parentName:"p"},"cy.then()"),"."),(0,i.kt)("p",null,"For example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},"describe('My suite', () => {\n  /** @type {import('apollo-testing-toolkit-link').TestingToolkitInterceptionManager} */\n  let apolloTestingToolkit\n\n  before(() => {\n    cy.visit('/')\n    cy.window()\n      .its('apolloTestingToolkit')\n      .then((toolkit) => {\n        // this looks like a code smell, but it isn't\n        // instance will not change and we will only use it inside future `then`s\n        // by that time the variable will have been set!\n        apolloTestingToolkit = toolkit\n      })\n  })\n\n  it('waits for the subscription, pushes out data and asserts the element updated', () => {\n    /** @type {import('apollo-testing-toolkit-link').InterceptApi} */\n    let getActiveUsersInterceptor\n\n    cy.then(() => {\n      getActiveUsersInterceptor = apolloTestingToolkit.intercept({\n        clientName: 'users',\n        operationName: 'getActiveUsers',\n      })\n    })\n\n    cy.then({ timeout: 5000 }, async () => {\n      await getActiveUsersInterceptor.waitForActiveSubscription()\n      getActiveUsersInterceptor.fireSubscriptionUpdate({\n        result: { data: { count: 10 } },\n      })\n    })\n\n    cy.get('activeUsers').contains(\n      'There are 10 users currently active on the website',\n    )\n  })\n})\n")),(0,i.kt)("h2",{id:"pitfall-data-that-comes-outside-of-apollo"},"Pitfall: Data that comes outside of Apollo"),(0,i.kt)("p",null,"With all the ease that ",(0,i.kt)("a",{parentName:"p",href:"/docs/logging-and-recording"},"recording and code generation")," gives,\nit might be easy to forget that there might be other sources of data on the path to success."),(0,i.kt)("p",null,"If you've set-up all the mocks that were captured and your application\nstill doesn't behave as expected, check the network tab to see\nif there ain't any good 'ol REST call on the way of our success!"),(0,i.kt)("p",null,"If yes, and they look relevant to your action, you might need to make another mock for this purpose.\nFortunately, Cypress provides us with the necessary built-in tools to move forward."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"// setup:\ncy.intercept(`**/api/v2/tickets/${issueId}?**`, myJsonFixtureResponse).as(\n  'issueFetch',\n)\n\n// wait for the call (if necessary):\ncy.wait('@issueFetch')\n")))}d.isMDXComponent=!0}}]);